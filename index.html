<!doctype html>
<html lang="bg">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Task Team Board</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <main id="authView" class="auth-wrap">
      <section class="panel auth-panel">
        <div class="brand">
          <span class="brand-dot"></span>
          <div>
            <p class="muted">Task Ops</p>
            <h1>Team Board</h1>
          </div>
        </div>
        <h2>Вход</h2>
        <form id="loginForm" class="auth-form">
          <label>
            Username
            <input id="loginUsername" type="text" required />
          </label>
          <label>
            Парола
            <input id="loginPassword" type="password" required />
          </label>
          <button type="submit">Влез</button>
          <p id="authError" class="error"></p>
          <p id="jsStatus" class="muted"></p>
        </form>
        <p class="muted">Demo: manager / admin123</p>
      </section>
    </main>

    <div id="appView" class="hidden">
      <div class="app-shell">
        <nav class="sidebar">
          <div class="brand brand--sidebar">
            <span class="brand-dot"></span>
            <div>
              <p class="muted">Task Ops</p>
              <h1>Team Board</h1>
            </div>
          </div>
          <div class="nav">
            <button class="nav-item" data-route="board" type="button">Board</button>
            <button class="nav-item" data-route="people" type="button">People</button>
            <button class="nav-item" data-route="activity" type="button">Activity</button>
            <button class="nav-item" data-route="notifications" type="button">
              Notifications <span id="notifBadge" class="badge">0</span>
            </button>
          </div>
          <div class="sidebar-footer">
            <label>
              Текущ потребител
              <input id="currentUserInfo" type="text" disabled />
              <small id="currentRoleBadge" class="muted"></small>
            </label>
            <button id="logoutBtn" type="button" class="btn-secondary">Изход</button>
          </div>
        </nav>

        <div class="content">
          <header class="pagebar">
            <div>
              <h2 id="pageTitle">Board</h2>
              <p id="pageSubtitle" class="muted"></p>
            </div>
            <div class="page-actions" id="pageActions">
              <button id="reloadDataBtn" type="button" class="btn-secondary">Reload data</button>
              <small id="healthBadge" class="muted"></small>
            </div>
          </header>

          <section id="view-board" class="view">
            <div class="layout">
              <section class="panel form-panel">
                <h3>Нова задача</h3>
                <form id="taskForm">
                  <label>
                    Заглавие
                    <input id="taskTitle" type="text" required />
                  </label>
                  <label>
                    Описание
                    <textarea id="taskDescription" rows="3"></textarea>
                  </label>
                  <label>
                    Отговорник
                    <select id="taskAssignee"></select>
                  </label>
                  <label>
                    Краен срок
                    <input id="taskDueDate" type="date" />
                  </label>
                  <label>
                    Група
                    <input id="taskGroup" type="text" placeholder="General" />
                  </label>
                  <label>
                    Етикети (със запетая)
                    <input id="taskLabels" type="text" placeholder="urgent, client" />
                  </label>
                  <button type="submit">Създай</button>
                </form>
              </section>

              <section class="panel board-panel">
                <div class="board-header">
                  <div>
                    <h3>Задачи</h3>
                    <p id="accessHint" class="muted"></p>
                  </div>
                  <div class="filters">
                    <input id="searchInput" type="text" placeholder="Търси..." />
                    <select id="statusFilter" title="Статус">
                      <option value="">Всички статуси</option>
                      <option value="todo">To Do</option>
                      <option value="inprogress">In Progress</option>
                      <option value="done">Done</option>
                    </select>
                    <select id="dueFilter" title="Срок">
                      <option value="">Всички срокове</option>
                      <option value="overdue">Просрочени</option>
                      <option value="next7">Следващи 7 дни</option>
                      <option value="nodue">Без срок</option>
                    </select>
                    <select id="groupFilter" title="Група"></select>
                    <select id="labelFilter" title="Етикет"></select>
                    <select id="assigneeFilter" title="Отговорник"></select>
                    <button id="clearFiltersBtn" type="button" class="btn-secondary">Clear</button>
                    <button id="toggleViewBtn" type="button" class="btn-secondary">Table</button>
                  </div>
                </div>
                <p id="resultsMeta" class="muted"></p>
                <div id="boardWrap">
                  <div id="board" class="board"></div>
                </div>
                <div id="tableWrap" class="hidden">
                  <div id="tasksTable" class="table"></div>
                </div>
              </section>

              <aside class="panel detail-panel" id="detailPanel">
                <h3>Детайли</h3>
                <p class="muted">Избери задача от борда.</p>
              </aside>
            </div>
          </section>

          <section id="view-people" class="view hidden">
            <div class="panel">
              <div class="people-head">
                <div>
                  <h3>People</h3>
                  <p class="muted">Управление на потребители (само мениджър).</p>
                </div>
              </div>

              <div class="people-create" id="peopleCreate">
                <h4>Добави потребител</h4>
                <div class="inline">
                  <input id="newUserUsername" type="text" placeholder="username" />
                  <input id="newUserInput" type="text" placeholder="име" />
                  <input id="newUserPhone" type="text" placeholder="+359..." />
                  <input id="newUserPassword" type="password" placeholder="парола" />
                  <select id="newUserRole">
                    <option value="employee">Служител</option>
                    <option value="manager">Мениджър</option>
                  </select>
                  <button id="addUserBtn" type="button">Добави</button>
                </div>
              </div>

              <div id="userAdminPanel" class="user-admin">
                <h4>Потребители</h4>
                <div id="userAdminList"></div>
              </div>
            </div>
          </section>

          <section id="view-activity" class="view hidden">
            <div class="panel">
              <div class="activity-head">
                <div>
                  <h3>Activity</h3>
                  <p class="muted">Глобална история (audit log).</p>
                </div>
                <div class="inline">
                  <select id="auditActorFilter"></select>
                  <select id="auditEntityFilter">
                    <option value="">Всички</option>
                    <option value="task">Tasks</option>
                    <option value="user">Users</option>
                  </select>
                  <button id="auditRefreshBtn" type="button" class="btn-secondary">Refresh</button>
                </div>
              </div>
              <div id="auditList" class="audit-list"></div>
            </div>
          </section>

          <section id="view-notifications" class="view hidden">
            <div class="panel">
              <div class="notif-header">
                <h3>Notifications</h3>
                <div class="inline">
                  <button id="enableWebNotifBtn" type="button" class="btn-secondary">Разреши браузър</button>
                  <button id="readAllBtn" type="button" class="btn-secondary">Прочети всички</button>
                </div>
              </div>
              <div id="notifList" class="notif-list"></div>
            </div>
          </section>
        </div>
      </div>
    </div>

    <script src="./app.js"></script>
    <script>
      // If app.js doesn't load/execute, make it obvious.
      setTimeout(() => {
        const el = document.getElementById("jsStatus");
        if (!el) return;
        if (window.__TASK_APP_READY__) {
          el.textContent = "JS: OK";
        } else {
          el.textContent = "JS: NOT LOADED (провери Network -> app.js / кеш / extension)";
        }
      }, 200);
    </script>
  </body>
</html>
